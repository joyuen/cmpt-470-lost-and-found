{{#> layout}}
  {{#*inline "head"}}
  <link rel="stylesheet" href="../css/layout.css">
<link rel="stylesheet" href="../css/postings.css">
<style>
    #searchKeywords {
        min-width: 300px;
    }

    #searchBox {
        display: block;
        text-align: center;
        margin-top: 50px;
        margin-bottom: 50px;
    }

    #search {
        display: inline-block; 
    }

    #advancedOptions {
        display: grid;
        grid-template-columns: 125px 375px;
        column-gap: 10px;
        margin: 10px;
        align-items: center;
    }

    .advancedOptionsLabel {
        text-align: right;
    }

    .advancedOptionsObject {
        text-align: left;
    }

    .advancedOptionsObject select, .advancedOptionsObject input {
        width: 100%;
    }

    
</style>
  {{/inline}}

  {{#*inline "content"}}
        <div id="searchBox">
            <form id="search">
                <input id="searchKeywords" name="keywords" placeholder="title/description keywords" type="text">
                <select name="status">
                    <option value="">All</option>
                    <option value="lost">Lost</option>
                    <option value="stolen">Stolen</option>
                    <option value="returned">Returned</option>
                </select>

                <div id="advancedOptions">
                    <div class="advancedOptionsLabel">
                        <label for="category">Category: </label>
                    </div>
                    <div class="advancedOptionsObject">
                        <select name="category">
                            <option value="">Any</option>
                            <option value = "wallet">Wallet</option>
                            <option value = "phone">Phone</option>
                            <option value = "keys">Keys</option>
                            <option value = "laptop">Laptop</option>
                            <option value = "pencilCase">Pencil Case</option>
                            <option value = "clothing">Clothing</option>
                            <option value = "textbook">Textbook</option>
                            <option value = "other">Other</option>
                        </select>
                    </div>
                    
                    <div class="advancedOptionsLabel">
                        <label for="campus">Campus: </label>
                    </div>
                    <div class="advancedOptionsObject">
                        <select name="campus">
                            <option value="">Any</option>
                            <option value="burnaby">Burnaby Mountain Campus</option>
                            <option value="surrey">Surrey Central Campus</option>
                            <option value="vancouver">Vancouver Campus</option>
                        </select>
                    </div>
                    <div class="advancedOptionsLabel">
                        <label for="building">Building: </label>
                    </div>
                    <div class="advancedOptionsObject">
                        <input name="building" placeholder="building" type="text">
                    </div>
                
                
                    <div class="advancedOptionsLabel">
                        <label for="room">Room: </label>
                    </div>
                    <div class="advancedOptionsObject">
                        <input name="room" placeholder="room" type="text">
                    </div>

                    <div class="advancedOptionsLabel">
                        <label for="lostDate">Lost Date: </label>
                        {{!-- <select name="dateSelector">
                            <option value="lost">Lost Date:</option>
                            <option value="create">Create Date:</option>
                        </select> --}}
                    </div>
                    <div class="advancedOptionsObject">
                        <input name="lostDateRange" type="text">
                    </div>
                
                    {{!-- <div class="advancedOptionsLabel">
                        <label for="creationDate">Creation Date: </label>
                    </div>
                    <div class="advancedOptionsObject">
                        <input name="creationDateRange" type="text">
                    </div>         --}}
                    </table>
                </div>

                <div id="formButtons">
                    <button id="showAdvanced">Show Advanced Options</button>
                    <button id="hideAdvanced">Hide Advanced Options</button>
                    <button type="submit">Search</button>
                </div>
            </form>
        </div>
        
        <table id="postings">
            {{#each postings}}
            <tr class="posting {{status}}">
                <td>{{post_status status}}</td>
                <td><a href={{url}}>{{title}}</a></td>
                <td>{{post_campus campus}}</td>
                <td>{{date_humanized}}</td>
            </tr>
            {{/each}}
        </table>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
        <script>
            var now = moment();
            
            $(document).ready(function(){
                $("#search").submit(function(e) {
                    e.preventDefault();

                    var form = $(this);
                    var formJson = {};
                    for (let obj of form.serializeArray()) {
                        formJson[obj.name] = obj.value;
                    }
                    var [start,end] = formJson["lostDateRange"].split(" - ");
                    formJson["lostDateStart"] = start ? start : "";
                    formJson["lostDateEnd"] = end ? end : "";
                    delete formJson["lostDateRange"];
                    formJson['numPostings'] = 10;

                    // don't submit any blank fields
                    for (let [key,val] of Object.entries(formJson)) {
                        if (val == "") {
                            delete formJson[key];
                        }
                    }                    

                    $.get(`/api/postings?${$.param(formJson)}`, function(data) {
                        console.log(data);
                    });
                });

                $('#showAdvanced').on('click', function(event) {
                    $('#advancedOptions').toggle();
                    $('#showAdvanced').hide();
                    $('#hideAdvanced').show();
                    event.preventDefault();
                });

                $('#hideAdvanced').on('click', function(event) {
                    $('#advancedOptions').toggle();
                    $('#showAdvanced').show();
                    $('#hideAdvanced').hide();
                    event.preventDefault();
                });
                
                // show options by default
                $('#advancedOptions').hide();
                $('#hideAdvanced').hide();

                var dateRangeFormat = {
                    locale: {
                        format: 'YYYY/MM/DD',
                        cancelLabel: 'Clear'
                    },
                    ranges: {
                        'Today': [moment().startOf('day'), moment()],
                        'Last 3 days': [moment().subtract(2, 'days').startOf('day'), moment()],
                        'Last 7 days': [moment().subtract(6, 'days').startOf('day'), moment()],
                        'Last 14 days': [moment().subtract(13, 'days').startOf('day'), moment()],
                        'Last 30 days': [moment().subtract(29, 'days').startOf('day'), moment()],
                    }
                };
                $('input[name="lostDateRange"]').daterangepicker(dateRangeFormat).val('');
            });
        </script>
  {{/inline}}
{{/layout}}